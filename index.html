<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üïí Contador de Dias</title>
<style>
  :root { --bg:#000; --panel:#111; --ink:#fff; --muted:#bbb; --accent:#4B0082; }
  *{box-sizing:border-box}
  body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--ink);margin:0}
  h1{margin:0;padding:16px;text-align:center;background:var(--accent)}
  .container{max-width:680px;margin:18px auto;padding:16px;background:#0b0b0b;border-radius:12px;box-shadow:0 0 15px var(--accent)}
  .row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  .row-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  input,button,select{width:100%;padding:10px;border:none;border-radius:8px;outline:none}
  input,select{background:#222;color:#fff}
  button{background:var(--accent);color:#fff;cursor:pointer}
  button:hover{opacity:.9}
  .split{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .muted{color:var(--muted);font-size:12px}
  .list{margin-top:12px}
  .item{display:flex;justify-content:space-between;gap:8px;align-items:flex-start;background:#151515;border:1px solid #222;border-radius:10px;padding:10px;margin:8px 0}
  .tag{display:inline-flex;align-items:center;gap:6px;background:#1f1f1f;border:1px solid #2a2a2a;color:#ddd;border-radius:999px;padding:4px 10px;font-size:12px}
  .actions{display:flex;gap:6px}
  .ghost{background:#232323}
  .danger{background:#6a0dad}
  .warn{background:#444}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .pill{display:inline-block;background:#1b1b1b;border:1px solid #2a2a2a;padding:6px 10px;border-radius:999px;font-size:12px}
</style>
</head>
<body>

<h1>üïí Contador de Dias</h1>

<div class="container">
  <div class="split">
    <h3>üîß Gerenciar Datas</h3>
    <div class="muted">Tudo √© salvo automaticamente no seu navegador.</div>
  </div>

  <div class="row">
    <input type="number" id="ano" placeholder="Ano (ex.: 2025)" />
    <input type="number" id="mes" placeholder="M√™s (1‚Äì12)" />
    <input type="number" id="dia" placeholder="Dia (1‚Äì31)" />
    <input type="text" id="descricao" placeholder="Descri√ß√£o do evento" />
  </div>

  <div class="row-2" style="margin-top:8px">
    <label class="pill" style="display:flex;align-items:center;gap:8px">
      <input type="checkbox" id="recorrente" /> Evento recorrente (todo ano)
    </label>
    <button id="btnAdd">‚ûï Adicionar/Alterar</button>
  </div>

  <div class="row-2" style="margin-top:8px">
    <input type="text" id="search" placeholder="Pesquisar por descri√ß√£o ou data (dd/mm/aaaa)..." />
    <div class="grid-3">
      <button id="btnExport" class="ghost">‚¨áÔ∏è Exportar JSON</button>
      <label class="ghost" style="display:flex;align-items:center;justify-content:center;cursor:pointer">
        ‚¨ÜÔ∏è Importar JSON <input type="file" id="fileImport" accept="application/json" style="display:none" />
      </label>
      <button id="btnClear" class="warn">üßπ Limpar tudo</button>
    </div>
  </div>
</div>

<div class="container">
  <div class="split">
    <h3>üìå Datas importantes</h3>
    <div id="resumo" class="muted"></div>
  </div>
  <div id="datas" class="list"></div>
</div>

<script>
(function(){
  const KEY = 'datasImportantes_v2';

  /** Estrutura: [ano, mes, dia, descricao, recorrente:boolean] */
  let datas = load() || [
    [2025, 4, 12, 'Data de Refer√™ncia', false],
    [2000, 8, 20, 'Meu Anivers√°rio', true] // exemplo como recorrente
  ];

  // ---------- Utils ----------
  const $ = (id) => document.getElementById(id);
  const pad = (n) => String(n).padStart(2, '0');

  function atMidnight(d){
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  function proxOcorrencia(ano, mes, dia, recorrente){
    // Se recorrente, calcula a pr√≥xima ocorr√™ncia (este ano ou pr√≥ximo).
    const hoje = atMidnight(new Date());
    let target = new Date(ano, mes-1, dia);
    if(recorrente){
      target.setFullYear(hoje.getFullYear());
      if (target < hoje) target.setFullYear(hoje.getFullYear()+1);
    }
    return atMidnight(target);
  }

  function diffDiasAte(ano, mes, dia, recorrente){
    const hoje = atMidnight(new Date());
    const alvo = proxOcorrencia(ano, mes, dia, recorrente);
    const diff = Math.round((alvo - hoje) / 86400000); // dias exatos
    return diff;
  }

  function legenda(diff){
    if (diff > 1)   return `Faltam ${diff} dias`;
    if (diff === 1) return 'Amanh√£';
    if (diff === 0) return '√â hoje!';
    if (diff === -1)return 'Ontem';
    return `J√° se passaram ${Math.abs(diff)} dias`;
  }

  function fmt(ano, mes, dia){
    return `${pad(dia)}/${pad(mes)}/${ano}`;
  }

  function save(){ localStorage.setItem(KEY, JSON.stringify(datas)); }
  function load(){
    try { return JSON.parse(localStorage.getItem(KEY) || 'null'); } catch { return null; }
  }

  function limparCampos(){
    ['ano','mes','dia','descricao'].forEach(id => $(id).value = '');
    $('recorrente').checked = false;
  }

  // ---------- Render ----------
  function render(){
    const filtro = ($('search').value || '').toLowerCase();
    const container = $('datas');
    container.innerHTML = '';

    // ordena: pr√≥ximos primeiro; depois passado
    const ordenadas = datas
      .map((d, i) => ({ i, d, diff: diffDiasAte(d[0], d[1], d[2], !!d[4]), nextDate: proxOcorrencia(d[0], d[1], d[2], !!d[4]) }))
      .sort((a,b) => (a.diff>=0) - (b.diff>=0) || a.diff - b.diff);

    const visiveis = ordenadas.filter(x => {
      const [ano, mes, dia, desc] = datas[x.i];
      const s = `${desc}`.toLowerCase();
      return s.includes(filtro) || fmt(ano,mes,dia).includes(filtro);
    });

    visiveis.forEach(({ i, d, diff, nextDate }) => {
      const [ano, mes, dia, desc, recorrente] = d;
      const div = document.createElement('div');
      div.className = 'item';

      const proxima = recorrente ? `${pad(nextDate.getDate())}/${pad(nextDate.getMonth()+1)}/${nextDate.getFullYear()}` : fmt(ano,mes,dia);

      div.innerHTML = `
        <div>
          <div><strong>${desc}</strong></div>
